<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truss System Architecture (Complete)</title>
    <style>
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: #f0f2f5; padding: 40px; display: flex; justify-content: center; }
        
        .main-card {
            background: white;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-radius: 16px;
            padding: 40px;
            display: flex;
            gap: 60px;
            max-width: 1400px;
        }

        .section {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 400px;
        }

        .header {
            font-size: 1.4em;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* MODERN CARD BLOCKS */
        .block {
            background: #fff;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            width: 100%;
            margin-bottom: 15px;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-color: #cbd5e1;
        }

        .block h3 { margin: 0 0 8px 0; font-size: 1em; color: #334155; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .block p { margin: 0; font-size: 0.85em; color: #64748b; line-height: 1.4; }
        
        /* Lists inside blocks */
        .block ul { margin: 5px 0; padding-left: 20px; font-size: 0.85em; color: #475569; }
        .block li { margin-bottom: 3px; }

        /* Specific Styles */
        .input-group { background: #fffbeb; border-color: #fcd34d; } /* Yellow for Inputs */
        .engine-group { background: #eff6ff; border-color: #60a5fa; } /* Blue for Engine */
        .output-group { background: #f0fdf4; border-color: #4ade80; } /* Green for Results */

        .arrow-down {
            width: 2px;
            height: 25px;
            background: #94a3b8;
            margin-bottom: 5px;
            position: relative;
        }
        .arrow-down::after {
            content:''; position:absolute; bottom:0; left:-4px;
            border-left:5px solid transparent; border-right:5px solid transparent; border-top:6px solid #94a3b8;
        }

        .big-arrow-right {
           display: flex; justify-content: center; align-items: center;
           font-size: 2em; color: #cbd5e1;
           width: 50px;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: bold;
            margin-top: 5px;
        }
        .badge-json { background: #f3f4f6; color: #4b5563; border: 1px solid #d1d5db; font-family: monospace; }
        
        /* CODE REFERENCE BADGE */
        .code-ref {
            display: block;
            margin-top: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.75em;
            color: #d946ef; /* Fuchsia for Code Link */
            background: #fae8ff;
            padding: 2px 5px;
            border-radius: 4px;
            border: 1px solid #f0abfc;
            width: fit-content;
        }

        .math-detail {
            background: rgba(255,255,255,0.6);
            border-left: 3px solid #3b82f6;
            padding-left: 10px;
            margin-top: 8px;
            font-size: 0.8em;
            color: #334155;
            font-style: italic;
        }

    </style>
</head>
<body>

    <div class="main-card">

        <!-- SECTION 1: PYTHON FRONTEND -->
        <div class="section">
            <div class="header">
                <span style="color:#f59e0b">●</span> 1. The Interface
            </div>

            <div class="block input-group">
                <h3>Start Application</h3>
                <p>Initialize Session State definitions</p>
                <span class="code-ref">app.py: Lines 1-30</span>
            </div>
            <div class="arrow-down"></div>

            <div class="block input-group">
                <h3>Global & Material Setup</h3>
                <ul>
                    <li><strong>Presets:</strong> Steel, Aluminum, Wood</li>
                    <li><strong>Custom:</strong> User defines E (GPa), Yield (MPa)</li>
                    <li><strong>Geometry:</strong> Beam X-Section Area (cm²)</li>
                </ul>
                <div class="math-detail">
                    Logic: Auto-converts units to SI (Pa, m²)<br>
                    Validation: Checks E > 0, Area > 0
                </div>
                <span class="code-ref">app.py: Lines 413-446</span>
            </div>
            <div class="arrow-down"></div>

            <div class="block input-group">
                <h3>Live Inputs (Main Layout)</h3>
                <p>Interactive DataFrames (Pandas)</p>
                <ul>
                    <li><strong>Joints:</strong> X, Y, Support Type (Pin/Roll/Fix)</li>
                    <li><strong>Beams:</strong> Start Node &rarr; End Node connectivity</li>
                    <li><strong>Loads:</strong> Force Magnitude (kN) & Angle (deg)</li>
                </ul>
                <div class="math-detail">
                    Event: realtime data_editor check<br>
                    Val: Prevent self-loops (Start==End)
                </div>
                <span class="code-ref">app.py: Lines 454-528</span>
            </div>
            <div class="arrow-down"></div>

            <div class="block input-group">
                <h3>Visualization Engine</h3>
                <ul>
                    <li>Reads live state JSON</li>
                    <li>Computes complexity scaling factor</li>
                    <li>Draws Plotly Nodes, Traces, & Arrows</li>
                </ul>
                <div class="math-detail">draw_bridge() function</div>
                <span class="code-ref">app.py: Lines 34-385</span>
            </div>
            <div class="arrow-down"></div>

            <div class="block" style="background:#1e293b; color:white; border:none; text-align:center;">
                <h3 style="color:white; margin:0; border:none;">Human Interactions</h3>
                <p style="color:#94a3b8;">User clicks RUN button</p>
                <span class="code-ref" style="background:#334155; color:#e2e8f0; border:none;">app.py: Line 583</span>
            </div>
            
            <div class="arrow-down"></div>
            
            <div class="block input-group" style="text-align:center;">
                <h3>Serialize Data</h3>
                <p>Converts Memory State &rarr; File</p>
                <ul>
                    <li>Nodes: {id, x, y, isFixedX, loadX...}</li>
                    <li>Elements: {id, start, end, E, A}</li>
                </ul>
                <span class="badge badge-json">Writes: input.json</span>
                <span class="code-ref">app.py: Lines 530-567</span>
            </div>
        </div>

        <div class="big-arrow-right">➜</div>

        <!-- SECTION 2: C++ SOLVER -->
        <div class="section">
            <div class="header">
                <span style="color:#3b82f6">●</span> 2. The Engine (Deep)
            </div>

            <div class="block engine-group" style="text-align:center;">
                <h3>Data Ingestion</h3>
                <p>Parses JSON Input Stream</p>
                <div class="math-detail">Allocates std::vector&lt;Node&gt; memory</div>
                <span class="code-ref">TrussSolver.cpp: Lines 47-89</span>
            </div>
            <div class="arrow-down"></div>

            <div class="block engine-group">
                <h3>Global Matrix Assembly</h3>
                <p>Iterates all beams to build [K]</p>
                <ul>
                    <li>Calc Length: L = &radic;(dx² + dy²)</li>
                    <li>Calc Stiffness: k = EA/L</li>
                    <li>Local Matrix: [k] (4x4)</li>
                    <li>Rotation Matrix: [T]</li>
                </ul>
                <div class="math-detail">
                    Global K += T<sup>T</sup> · k · T
                </div>
                <span class="code-ref">TrussSolver.cpp: Lines 92-130</span>
            </div>
            <div class="arrow-down"></div>

            <div class="block engine-group">
                <h3>Apply Boundary Conditions</h3>
                <p>Reduces System Degrees of Freedom</p>
                <ul>
                    <li>If Pinned: Fix UX, UY</li>
                    <li>If Roller: Fix UY (usually)</li>
                </ul>
                <div class="math-detail">Zeroes out rows/cols in K matrix</div>
                <span class="code-ref">TrussSolver.cpp: Lines 133-136</span>
            </div>
            <div class="arrow-down"></div>

            <div class="block engine-group" style="border: 2px solid #3b82f6;">
                <h3>LU Solver (Eigen)</h3>
                <p>Solves Linear System: <strong>K·u = F</strong></p>
                <ul>
                    <li>1. Check Singularity (Det &asymp; 0)</li>
                    <li>2. Decompose K &rarr; L·U</li>
                    <li>3. Forward/Back Substitution</li>
                </ul>
                <div class="math-detail">Returns Displacement Vector {u}</div>
                <span class="code-ref">TrussSolver.cpp: Lines 141-144</span>
            </div>
            <div class="arrow-down"></div>

            <div class="block engine-group">
                <h3>Post-Processing</h3>
                <p>Back-calculates element physics</p>
                <ul>
                    <li>Strain &epsilon; = &Delta;L / L</li>
                    <li>Stress &sigma; = E · &epsilon;</li>
                    <li>Force F = &sigma; · A</li>
                    <li>Safety = Yield / &sigma;</li>
                </ul>
                <span class="code-ref">TrussSolver.cpp: Lines 154-172</span>
            </div>
            <div class="arrow-down"></div>

            <div class="block engine-group">
                <h3>Output Generation</h3>
                <p>Formats JSON Output Stream</p>
                <span class="badge badge-json">Writes: output.json</span>
                <span class="code-ref">TrussSolver.cpp: Lines 177-189</span>
            </div>
        </div>

        <div class="big-arrow-right">➜</div>

        <!-- SECTION 3: RESULTS -->
        <div class="section">
            <div class="header">
                <span style="color:#22c55e">●</span> 3. Analysis
            </div>
            
            <div class="block output-group">
                <h3>Process Results</h3>
                <p>Python reads subprocess stdout</p>
                <div class="math-detail">Updates Session State with new Data</div>
                <span class="code-ref">app.py: Lines 607-610</span>
            </div>
            <div class="arrow-down"></div>

            <!-- CRITICAL CHECK 1: STABILITY -->
            <div class="block output-group" style="border-left: 5px solid #ec4899;">
                <h3>Stability Check</h3>
                <p>Did the solver find a solution?</p>
                <ul>
                    <li>If <strong>Unstable</strong> &rarr; Stop & Warn</li>
                    <li>"Bridge geometry incomplete"</li>
                </ul>
                <span class="code-ref">app.py: Lines 611-613</span>
            </div>
            <div class="arrow-down"></div>

            <!-- CRITICAL CHECK 2: SAFETY -->
            <div class="block output-group">
                <h3>Metrics Dashboard</h3>
                <p>Calculates & Displays KPIs</p>
                <ul>
                    <li>Total Load (kN)</li>
                    <li>Material Usage (Efficiency)</li>
                    <li>Max Stress (MPa)</li>
                </ul>
                <span class="code-ref">app.py: Lines 616-625</span>
            </div>

            <div class="arrow-down"></div>

            <div style="display:flex; gap:10px;">
                <div class="block" style="background:#fee2e2; border-color:#fca5a5;">
                    <h3>Material Failure</h3>
                    <p style="color:#b91c1c;">FS < 1.0<br>Shows Red Warning</p>
                    <span class="code-ref">app.py: Lines 630-632</span>
                </div>
                <div class="block" style="background:#dcfce7; border-color:#86efac;">
                    <h3>Material Stable</h3>
                    <p style="color:#15803d;">FS > 1.0<br>Shows Green Badge</p>
                    <span class="code-ref">app.py: Lines 630-632</span>
                </div>
            </div>

            <div class="arrow-down"></div>
           
            <div class="block output-group">
                <h3>Report Tables</h3>
                <p>Renders Pandas Dataframes</p>
                <ul>
                    <li><strong>Reactions:</strong> Fixities with Rx, Ry > 0</li>
                    <li><strong>Beams:</strong> Force, Tension/Compression, FS</li>
                </ul>
                <span class="code-ref">app.py: Lines 634-661</span>
            </div>

            <div class="arrow-down"></div>
            
            <div class="block" style="background:#1e293b; color:white; border:none; text-align:center; border-radius:20px;">
                <h3 style="color:white; margin:0;">End User Task</h3>
            </div>

        </div>

    </div>

</body>
</html>
